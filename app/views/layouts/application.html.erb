<!DOCTYPE html>
<html>
<head>
  <title>Caketop Theater</title>
  <%= stylesheet_link_tag    "application", :media => "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
</head>
<body>

  <div id="wrap">
    <div class="container">

      <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">CAKETOP THEATER</a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
              <% if request.original_url.include?('music') %>
              <li><a href="#" id="back"><span class="glyphicon glyphicon-step-backward"></span></a></li>
                <li><a href="#" id="play-pause" class="pause"><span id="play-pause-span" class="glyphicon glyphicon-pause"></span></a></li>
                <li><a href="#" id="forward"><span class="glyphicon glyphicon-step-forward"></span></a></li>
              <% end %>

              <li><%= link_to "Home", '/theater' %></li>

              <li class="divider"></li>
              <li><%= link_to "Films", movies_path %></li>
              <% if request.original_url.include?('movies') %>
              <li>
                <%= form_tag(movies_search_path, class: 'navbar-form', role: 'search') do %>
                <div class="form-group">
                  <input type="text" class="form-control" placeholder="Search Films" name="q">
                </div>
                <% end %>
              </li>
              <% end %>

              <li class="divider"></li>
              <li><%= link_to "TV", shows_path %></li>
              <% if request.original_url.include?('shows') %>
              <li>
                <%= form_tag(shows_search_path, class: 'navbar-form', role: 'search') do %>
                <div class="form-group">
                  <input type="text" class="form-control" placeholder="Search TV Shows" name="q">
                </div>
                <% end %>
              </li>
              <% end %>

              <li class="divider"></li>
              <li><%# link_to "Music", music_path %></li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>

      <%= yield %>
    </div>
    <div id="push"></div>
  </div>

  <div id="footer">
    <p style="padding:0px 10px 10px 0px;">Not affiliated with Westmont College. <a href="https://github.com/XanderStrike/movie-browser/">Github</a>. <a href="#" data-toggle="modal" data-target="#request-modal">Request</a>. <%= link_to "About", about_path %>.</p>
  </div>

  <%= render partial: 'requests/modal' %>


  <li><audio id="nav-audio-controls">
      <source src="" id="nav-audio-source">
  </audio></li>


  <script>
  init();
  function init(){

  $('#nav-audio-controls')[0].addEventListener('ended',function(e){
    next();
  });
  $('#back')[0].onclick = function(){
    prev();
  }
  $("#play-pause")[0].onclick = function(){
    if ($("#play-pause-span").hasClass("glyphicon-play")) {
      $("#play-pause-span").addClass("glyphicon-pause").removeClass("glyphicon-play");
      document.getElementById("nav-audio-controls").play();
    } else {
      $("#play-pause-span").addClass("glyphicon-play").removeClass("glyphicon-pause");
      document.getElementById("nav-audio-controls").pause();
    }
  }
  $('#forward')[0].onclick = function(){
    next();
  }
  }

  function next() {
    $('.active').next().find('a').click();
  }
  function prev() {
    $('.active').prev().find('a').click();
  }

  function changeSong(elem, fp) {
    document.getElementById("nav-audio-source").src=fp;
    var player = document.getElementById("nav-audio-controls");
    player.load();
    player.play();
    $(elem).parent().addClass('active').siblings().removeClass('active');
  }
  </script>

</body>
</html>
